<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Güvenlik Açığı Tarayıcı</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-text-fill-color: transparent;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .upload-area.dragover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .scan-results {
            margin-top: 30px;
            display: none;
        }
        
        .vulnerability {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid;
        }
        
        .vulnerability.high {
            border-left-color: #e74c3c;
        }
        
        .vulnerability.medium {
            border-left-color: #f39c12;
        }
        
        .vulnerability.low {
            border-left-color: #f1c40f;
        }
        
        .vulnerability.info {
            border-left-color: #3498db;
        }
        
        .vuln-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .vuln-title {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .severity-badge {
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .severity-high { background: #e74c3c; }
        .severity-medium { background: #f39c12; }
        .severity-low { background: #f1c40f; color: #333; }
        .severity-info { background: #3498db; }
        
        .vuln-description {
            color: #666;
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .vuln-line {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border-left: 3px solid #ddd;
        }
        
        .line-number {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            margin-right: 8px;
        }
        
        .line-number:hover {
            background: #764ba2;
            transform: scale(1.05);
        }
        
        .code-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            border: 1px solid #4a5568;
        }
        
        .code-line {
            display: block;
            padding: 2px 0;
            position: relative;
        }
        
        .code-line.highlight {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid #ef4444;
            padding-left: 10px;
            margin-left: -13px;
        }
        
        .code-line-num {
            color: #718096;
            margin-right: 15px;
            font-size: 0.75rem;
            user-select: none;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔒 JavaScript Güvenlik Tarayıcı</h1>
        
        <div class="upload-area" onclick="document.getElementById('fileInput').click()" id="uploadArea">
            <div class="upload-text">
                JavaScript dosyalarınızı buraya sürükleyin veya tıklayarak seçin
            </div>
            <button type="button" class="btn">Dosya Seç</button>
            <input type="file" id="fileInput" multiple accept=".js,.jsx,.ts,.tsx">
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Dosyalar taranıyor...</p>
        </div>
        
        <div class="scan-results" id="results">
            <div class="stats" id="stats"></div>
            <div id="vulnerabilities"></div>
        </div>
    </div>

    <script>
        class SecurityScanner {
            constructor() {
                this.vulnerabilities = [];
                this.setupEventListeners();
                this.initializePatterns();
            }
            
            initializePatterns() {
                this.patterns = {
                    xss: {
                        name: 'XSS (Cross-Site Scripting)',
                        severity: 'high',
                        patterns: [
                            /innerHTML\s*=\s*.*[\+\$]/,
                            /document\.write\s*\(/,
                            /\.html\s*\(\s*.*[\+\$]/,
                            /eval\s*\(/,
                            /Function\s*\(/,
                            /setTimeout\s*\(\s*["'`].*["'`]/,
                            /setInterval\s*\(\s*["'`].*["'`]/
                        ],
                        description: 'Kullanıcı girdilerinin güvenli olmayan şekilde DOM\'a eklenmesi XSS açığına yol açabilir.'
                    },
                    sqlInjection: {
                        name: 'SQL Injection',
                        severity: 'high',
                        patterns: [
                            /["']\s*\+\s*.*\+\s*["'].*(?:SELECT|INSERT|UPDATE|DELETE|DROP)/i,
                            /query\s*\(\s*["'`].*\$.*["'`]/,
                            /execute\s*\(\s*["'`].*\+.*["'`]/
                        ],
                        description: 'SQL sorgularında kullanıcı girdilerinin doğrudan kullanılması SQL injection açığı oluşturur.'
                    },
                    hardcodedSecrets: {
                        name: 'Hardcoded Secrets',
                        severity: 'high',
                        patterns: [
                            /(?:password|pwd|pass)\s*[:=]\s*["'`][^"'`]{6,}/i,
                            /(?:api[_-]?key|apikey)\s*[:=]\s*["'`][a-zA-Z0-9]{20,}/i,
                            /(?:secret|token)\s*[:=]\s*["'`][a-zA-Z0-9]{16,}/i,
                            /(?:private[_-]?key|privatekey)\s*[:=]/i
                        ],
                        description: 'Kodda sabit olarak tanımlanmış şifreler ve API anahtarları güvenlik riski oluşturur.'
                    },
                    insecureRandom: {
                        name: 'Güvensiz Rastgele Sayı',
                        severity: 'medium',
                        patterns: [
                            /Math\.random\(\)/
                        ],
                        description: 'Math.random() kriptografik olarak güvenli değildir. Güvenlik amaçlı crypto.getRandomValues() kullanın.'
                    },
                    unsafeRedirect: {
                        name: 'Güvensiz Yönlendirme',
                        severity: 'medium',
                        patterns: [
                            /window\.location\s*=\s*.*[\+\$]/,
                            /location\.href\s*=\s*.*[\+\$]/,
                            /location\.replace\s*\(\s*.*[\+\$]/
                        ],
                        description: 'Kullanıcı girdilerine dayalı yönlendirmeler open redirect açığına yol açabilir.'
                    },
                    localStorageXSS: {
                        name: 'LocalStorage XSS',
                        severity: 'medium',
                        patterns: [
                            /localStorage\.getItem\s*\(.*\).*innerHTML/,
                            /sessionStorage\.getItem\s*\(.*\).*innerHTML/,
                            /localStorage\[.*\].*innerHTML/
                        ],
                        description: 'LocalStorage\'dan alınan verilerin doğrudan DOM\'a eklenmesi XSS riski oluşturur.'
                    },
                    weakValidation: {
                        name: 'Zayıf Validasyon',
                        severity: 'low',
                        patterns: [
                            /\.length\s*>\s*0(?!\s*&&)/,
                            /!.*\.length/,
                            /if\s*\(\s*[^)]*\s*\)\s*{[^}]*return/
                        ],
                        description: 'Yetersiz input validasyonu güvenlik sorunlarına yol açabilir.'
                    },
                    consoleLog: {
                        name: 'Debug Bilgileri',
                        severity: 'info',
                        patterns: [
                            /console\.log\s*\(/,
                            /console\.error\s*\(/,
                            /console\.warn\s*\(/,
                            /debugger;?/
                        ],
                        description: 'Production kodunda debug bilgileri hassas veri sızıntısına yol açabilir.'
                    },
                    httpUrls: {
                        name: 'Güvensiz HTTP URL',
                        severity: 'low',
                        patterns: [
                            /["'`]http:\/\/[^"'`]*/
                        ],
                        description: 'HTTP URL\'leri güvenli değildir. HTTPS kullanın.'
                    },
                    vulnerableRegex: {
                        name: 'ReDoS Riski',
                        severity: 'medium',
                        patterns: [
                            /new\s+RegExp\s*\(\s*["'`].*\(\.\*\)\+.*["'`]/,
                            /\/.*\(\.\*\)\+.*\//,
                            /\/.*\(\.\+\)\*.*\//
                        ],
                        description: 'Karmaşık regex kalıpları ReDoS (Regular Expression Denial of Service) saldırılarına açık olabilir.'
                    }
                };
            }
            
            setupEventListeners() {
                const fileInput = document.getElementById('fileInput');
                const uploadArea = document.getElementById('uploadArea');
                
                fileInput.addEventListener('change', (e) => this.handleFiles(e.target.files));
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });
            }
            
            async handleFiles(files) {
                const jsFiles = Array.from(files).filter(file => 
                    file.name.match(/\.(js|jsx|ts|tsx)$/i)
                );
                
                if (jsFiles.length === 0) {
                    alert('Lütfen JavaScript dosyalarını seçin (.js, .jsx, .ts, .tsx)');
                    return;
                }
                
                this.showLoading(true);
                this.vulnerabilities = [];
                
                for (const file of jsFiles) {
                    await this.scanFile(file);
                }
                
                this.displayResults();
                this.showLoading(false);
            }
            
            async scanFile(file) {
                const content = await this.readFile(file);
                const lines = content.split('\n');
                
                lines.forEach((line, lineNumber) => {
                    this.scanLine(line, lineNumber + 1, file.name, lines);
                });
            }
            
            readFile(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsText(file);
                });
            }
            
            scanLine(line, lineNumber, fileName, allLines) {
                Object.entries(this.patterns).forEach(([key, pattern]) => {
                    pattern.patterns.forEach(regex => {
                        if (regex.test(line.trim())) {
                            // Bulguyu çevreleyen satırları al (önceki 2, sonraki 2)
                            const startLine = Math.max(0, lineNumber - 3);
                            const endLine = Math.min(allLines.length - 1, lineNumber + 1);
                            const contextLines = allLines.slice(startLine, endLine + 1);
                            
                            this.vulnerabilities.push({
                                type: pattern.name,
                                severity: pattern.severity,
                                description: pattern.description,
                                line: lineNumber,
                                code: line.trim(),
                                file: fileName,
                                context: contextLines,
                                contextStart: startLine + 1
                            });
                        }
                    });
                });
            }
            
            displayResults() {
                const resultsDiv = document.getElementById('results');
                const statsDiv = document.getElementById('stats');
                const vulnDiv = document.getElementById('vulnerabilities');
                
                resultsDiv.style.display = 'block';
                
                // İstatistikleri hesapla
                const stats = {
                    total: this.vulnerabilities.length,
                    high: this.vulnerabilities.filter(v => v.severity === 'high').length,
                    medium: this.vulnerabilities.filter(v => v.severity === 'medium').length,
                    low: this.vulnerabilities.filter(v => v.severity === 'low').length,
                    info: this.vulnerabilities.filter(v => v.severity === 'info').length
                };
                
                statsDiv.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">Toplam Bulgu</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #e74c3c">${stats.high}</div>
                        <div class="stat-label">Yüksek Risk</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #f39c12">${stats.medium}</div>
                        <div class="stat-label">Orta Risk</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #f1c40f">${stats.low}</div>
                        <div class="stat-label">Düşük Risk</div>
                    </div>
                `;
                
                if (this.vulnerabilities.length === 0) {
                    vulnDiv.innerHTML = `
                        <div class="vulnerability info">
                            <div class="vuln-header">
                                <div class="vuln-title">🎉 Tebrikler!</div>
                                <span class="severity-badge severity-info">Temiz</span>
                            </div>
                            <div class="vuln-description">
                                Taranan dosyalarda bilinen güvenlik açığı tespit edilmedi.
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Bulgları şiddete göre sırala
                const sortedVulns = this.vulnerabilities.sort((a, b) => {
                    const order = { high: 4, medium: 3, low: 2, info: 1 };
                    return order[b.severity] - order[a.severity];
                });
                
                vulnDiv.innerHTML = sortedVulns.map((vuln, index) => `
                    <div class="vulnerability ${vuln.severity}">
                        <div class="vuln-header">
                            <div class="vuln-title">${vuln.type}</div>
                            <span class="severity-badge severity-${vuln.severity}">${this.getSeverityText(vuln.severity)}</span>
                        </div>
                        <div class="vuln-description">${vuln.description}</div>
                        <div class="vuln-line">
                            <strong>📁 Dosya:</strong> ${vuln.file} <br>
                            <strong>📍 Satır:</strong> <span class="line-number" onclick="showLineDetail(${index})">${vuln.line}</span>
                            <strong>⚠️ Kod:</strong> <code>${this.escapeHtml(vuln.code)}</code>
                            <div id="detail-${index}" style="display: none;">
                                <div class="code-preview">
                                    ${this.generateCodePreview(vuln)}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Global function tanımla
                window.showLineDetail = (index) => {
                    const detail = document.getElementById(`detail-${index}`);
                    const isVisible = detail.style.display !== 'none';
                    
                    // Tüm detayları kapat
                    document.querySelectorAll('[id^="detail-"]').forEach(d => d.style.display = 'none');
                    
                    // Eğer kapalıysa aç
                    if (!isVisible) {
                        detail.style.display = 'block';
                        detail.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                };
            }
            
            generateCodePreview(vuln) {
                if (!vuln.context || vuln.context.length === 0) {
                    return `<span class="code-line highlight">
                        <span class="code-line-num">${vuln.line}:</span>${this.escapeHtml(vuln.code)}
                    </span>`;
                }
                
                return vuln.context.map((line, index) => {
                    const lineNum = vuln.contextStart + index;
                    const isProblematicLine = lineNum === vuln.line;
                    const lineClass = isProblematicLine ? 'code-line highlight' : 'code-line';
                    
                    return `<span class="${lineClass}">
                        <span class="code-line-num">${lineNum}:</span>${this.escapeHtml(line)}
                    </span>`;
                }).join('\n');
            }
            
            getSeverityText(severity) {
                const texts = {
                    high: 'Yüksek Risk',
                    medium: 'Orta Risk',
                    low: 'Düşük Risk',
                    info: 'Bilgi'
                };
                return texts[severity] || severity;
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
            }
        }
        
        // Uygulamayı başlat
        new SecurityScanner();
    </script>
</body>
</html>